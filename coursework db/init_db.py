import os
import sys

# –î–æ–¥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–æ —à–ª—è—Ö—ñ–≤ –ø–æ—à—É–∫—É –º–æ–¥—É–ª—ñ–≤
sys.path.append(os.getcwd())

from app.db import Database


def init_database():
    print("üöÄ –ó–∞–ø—É—Å–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö...")

    # 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î —Ñ–∞–π–ª
    file_path = os.path.join('sql', 'full_setup.sql')

    if not os.path.exists(file_path):
        print(f"‚ùå –ü–û–ú–ò–õ–ö–ê: –§–∞–π–ª '{file_path}' –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!")
        print(f"   –ü–æ—Ç–æ—á–Ω–∞ –ø–∞–ø–∫–∞: {os.getcwd()}")
        print("   –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø–∞–ø–∫–∞ 'sql' –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –ø–æ—Ä—É—á —ñ–∑ —Ñ–∞–π–ª–æ–º 'init_db.py'")
        return

    # 2. –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ—Å—è –¥–æ –ë–î
    try:
        db = Database()
        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è
        conn = db.connect()
        print("‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ PostgreSQL —É—Å–ø—ñ—à–Ω–µ.")
    except Exception as e:
        print(f"‚ùå –ü–û–ú–ò–õ–ö–ê –ü–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø: {e}")
        print("   –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ–∞–π–ª .env (—Ö–æ—Å—Ç, –ø–æ—Ä—Ç, –ø–∞—Ä–æ–ª—å)")
        return

    # 3. –í–∏–∫–æ–Ω—É—î–º–æ SQL —Ñ–∞–π–ª
    print(f"üîÑ –í–∏–∫–æ–Ω—É—î–º–æ —Ñ–∞–π–ª: {file_path} ...")
    try:
        db.execute_file(file_path)
        print("\nüéâ –ë–î –£–°–ü–Ü–®–ù–û –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–û–í–ê–ù–û! üéâ")
        print("–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç–∏ app.py")
    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ SQL: {e}")


if __name__ == "__main__":
    init_database()