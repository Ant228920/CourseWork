-- 1. Список військових частин з належністю
SELECT ч."id", ч."номер", ч."назва", д."номер" AS "дивізія", к."номер" AS "корпус", а."номер" AS "армія", о."назва" AS "округ"
FROM "військова_частина" ч
JOIN "дивізія" д ON д."id"=ч."дивізія_id"
JOIN "корпус" к ON к."id"=д."корпус_id"
JOIN "армія" а ON а."id"=к."армія_id"
JOIN "військовий_округ" о ON о."id"=а."військовий_округ_id";

-- 2. Підрахунок техніки по типах у частині
SELECT тт."назва" AS "тип", COUNT(*) AS "кількість"
FROM "техніка" т
JOIN "тип_техніки" тт ON тт."id"=т."тип_техніки_id"
WHERE т."військова_частина_id" = $PART_ID
GROUP BY тт."назва" ORDER BY 2 DESC;

-- 3. Озброєння по підрозділах
SELECT п."назва" AS "підрозділ", COUNT(о."id") AS "одиниці"
FROM "озброєння" о
LEFT JOIN "підрозділ" п ON п."id"=о."підрозділ_id"
WHERE о."військова_частина_id" = $PART_ID
GROUP BY п."назва";

-- 4. Персонал за званнями у дивізії
SELECT "звання", COUNT(*) AS "кількість"
FROM "військовослужбовець" в
JOIN "військова_частина" ч ON ч."id"=в."військова_частина_id"
WHERE ч."дивізія_id"=$DIV_ID
GROUP BY "звання" ORDER BY 2 DESC;

-- 5. Список споруд частини
SELECT s."назва", s."тип", s."адреса" FROM "споруда" s WHERE s."військова_частина_id"=$PART_ID;

-- 6. Пошук військовослужбовців по ПІБ
SELECT * FROM "військовослужбовець"
WHERE LOWER("прізвище"||' '||"ім'я"||' '||COALESCE("по_батькові",'')) LIKE LOWER('%'||$Q||'%');

-- 7. Середній рік випуску техніки по типах
SELECT тт."назва" AS "тип", AVG(т."рік_випуску")::INT AS "середній_рік"
FROM "техніка" т JOIN "тип_техніки" тт ON тт."id"=т."тип_техніки_id"
GROUP BY тт."назва";

-- 8. Частини з найбільшою кількістю техніки
SELECT ч."номер", ч."назва", COUNT(т."id") AS "техніка"
FROM "військова_частина" ч LEFT JOIN "техніка" т ON т."військова_частина_id"=ч."id"
GROUP BY ч."id" ORDER BY 3 DESC LIMIT 10;

-- 9. Підлеглі структури (округ->армія->корпус->дивізія) одним запитом
SELECT о."назва" AS "округ", а."номер" AS "армія", к."номер" AS "корпус", д."номер" AS "дивізія"
FROM "військовий_округ" о
LEFT JOIN "армія" а ON а."військовий_округ_id"=о."id"
LEFT JOIN "корпус" к ON к."армія_id"=а."id"
LEFT JOIN "дивізія" д ON д."корпус_id"=к."id";

-- 10. Кадрові події по датах прийняття
SELECT DATE_TRUNC('month', "дата_прийняття") AS "місяць", COUNT(*) AS "прийнято"
FROM "військовослужбовець"
WHERE "дата_прийняття" IS NOT NULL
GROUP BY 1 ORDER BY 1;
